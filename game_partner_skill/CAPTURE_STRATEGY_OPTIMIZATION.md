# 截图策略优化方案

## 📊 问题分析

### 原方案 (30 FPS)
- **截图频率**: 30 次/秒
- **CPU 占用**: 预计 10%+
- **AI 处理**: 每秒 30 张图,大量冗余
- **API 成本**: 如使用 GPT-4V,每秒 $0.01 × 30 = $0.30/秒 ❌
- **适用场景**: 游戏录制、实时监控

### 新方案 (间隔模式)
- **截图频率**: 可调 1-15 秒,默认 3 秒
- **CPU 占用**: < 5%
- **AI 处理**: 每 3 秒一张,足够理解游戏状态
- **API 成本**: 每 3 秒 $0.01 = $0.003/秒 ✅ (减少 99%)
- **适用场景**: AI 游戏助手、策略分析

## 🎯 优化决策

### 用户需求
1. **AI 分析游戏状态** - 不需要连续帧,关键时刻的画面即可
2. **低资源占用** - 后台运行不影响游戏性能
3. **成本控制** - 降低 API 调用频率

### 技术考量
1. **LLM 处理速度** - GPT-4V 分析一张图需 2-5 秒
2. **上下文连续性** - 3 秒间隔不会错过重要游戏事件
3. **用户期望** - 非实时监控,而是智能助手

## 💡 实现方案

### 前端配置
```typescript
interface CaptureConfig {
  mode: "fullscreen" | "window" | "area";
  interval: number; // 1-15 秒,默认 3
  hotkey?: string;  // 手动触发快捷键 (F12)
}
```

### 滑块控件
- **范围**: 1-15 秒
- **默认值**: 3 秒
- **标记点**: 1s, 3s, 5s, 10s, 15s
- **提示文本**: "💡 提示: 间隔越短,CPU 占用越高。推荐 3-5 秒用于 AI 分析"

### 捕获逻辑
```typescript
// 立即截取一次
await captureScreenshot();

// 设置定时器
const timer = setInterval(() => {
  captureScreenshot();
}, captureInterval * 1000);
```

## 📈 性能对比

| 指标 | 30 FPS | 间隔 3s | 改善 |
|-----|--------|---------|------|
| 截图次数/分钟 | 1800 | 20 | ⬇️ 99% |
| CPU 占用 | ~10% | <5% | ⬇️ 50%+ |
| 内存占用 | 中等 | 低 | ⬇️ 30% |
| API 成本/小时 | $1080 | $12 | ⬇️ 99% |
| 响应延迟 | 即时 | 最多 3s | ⚠️ 可接受 |

## 🚀 未来优化方向

### 1. 智能间隔调整
```typescript
// 根据游戏状态自动调整
if (inCombat) {
  interval = 1; // 战斗加速
} else if (inCutscene) {
  interval = 10; // 过场减速
} else {
  interval = 3; // 正常探索
}
```

### 2. 事件驱动触发
```typescript
// 额外触发条件
const events = {
  playerDeath: () => captureImmediately(),
  bossDefeated: () => captureImmediately(),
  userHotkey: () => captureImmediately(),
};
```

### 3. AI 主动请求
```typescript
// LLM 判断需要更多信息
AI: "画面信息不足,请再截一张图"
→ 立即截图
→ 继续分析
```

## ✅ 决策总结

### 采纳方案
**间隔模式 (1-15s 可调,默认 3s)**

### 理由
1. ✅ **符合产品定位** - AI 助手,非录屏工具
2. ✅ **资源友好** - CPU < 5%,可后台运行
3. ✅ **成本可控** - API 费用降低 99%
4. ✅ **用户体验** - 3 秒延迟可接受
5. ✅ **实现简单** - 只需修改定时器参数

### 保留扩展性
- 支持用户自定义间隔 (1-15s)
- 预留手动触发快捷键
- 为未来智能模式留接口

## 📝 代码修改清单

### 已完成 ✅
- [x] 更新 `DEVELOPMENT_PLAN.md` - 修改性能目标
- [x] 修改前端状态 - `fps` → `captureInterval`
- [x] 更新 UI 组件 - FPS 滑块 → 间隔滑块
- [x] 修改定时器逻辑 - `1000 / fps` → `interval * 1000`
- [x] 更新显示文本 - "30 FPS" → "每 3 秒"

### 待优化 ⏳
- [ ] 添加手动触发按钮
- [ ] 实现快捷键绑定 (F12)
- [ ] 添加智能间隔模式开关
- [ ] 性能监控面板

## 🎓 经验总结

### 关键洞察
> **"AI 不需要连续帧,只需关键时刻"**

游戏助手与游戏录制本质不同:
- 录制: 需要流畅画面 (30-60 FPS)
- AI 助手: 需要理解状态 (每几秒即可)

### 设计原则
1. **以终为始** - 从 AI 分析需求倒推截图频率
2. **成本意识** - API 调用每次都是钱
3. **用户导向** - 低占用比实时性更重要
4. **灵活可控** - 给用户选择权

---

**版本**: v0.2.0  
**修改日期**: 2026-01-29  
**状态**: ✅ 已实施  
**下一步**: 集成 OCR 和 AI 分析
